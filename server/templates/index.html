<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduFlow | Smart Onboarding</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            500: '#6366f1',
                            600: '#4f46e5',
                            glow: 'rgba(99, 102, 241, 0.5)',
                            dark: '#312e81'
                        },
                        glass: {
                            100: 'rgba(255, 255, 255, 0.03)',
                            200: 'rgba(255, 255, 255, 0.05)',
                            border: 'rgba(255, 255, 255, 0.08)',
                            highlight: 'rgba(255, 255, 255, 0.15)'
                        }
                    },
                    animation: {
                        'blob': 'blob 20s infinite alternate cubic-bezier(0.4, 0, 0.2, 1)',
                        'shimmer': 'shimmer 2.5s linear infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'fade-in-up': 'fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '-1000px 0' },
                            '100%': { backgroundPosition: '1000px 0' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        fadeInUp: {
                            '0%': { opacity: 0, transform: 'translateY(20px) scale(0.98)' },
                            '100%': { opacity: 1, transform: 'translateY(0) scale(1)' }
                        }
                    }
                }
            }
        }
    </script>

    <!-- VISUAL UPGRADES CSS -->
    <style>
        /* --- 1. Global Reset & Typography --- */
        body {
            background-color: #020617; /* Deepest Slate */
            color: #f8fafc;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            font-feature-settings: "cv02", "cv03", "cv04", "cv11";
        }

        /* --- 2. Ambient Background (Part A) --- */
        .ambient-layer {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -2;
            overflow: hidden;
            pointer-events: none;
        }
        .blob-bg {
            position: absolute;
            border-radius: 50%;
            filter: blur(90px);
            opacity: 0.4;
            animation: blob 20s infinite alternate;
        }
        .blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: radial-gradient(circle, #4f46e5 0%, transparent 60%); }
        .blob-2 { bottom: -10%; right: -10%; width: 50vw; height: 50vw; background: radial-gradient(circle, #312e81 0%, transparent 60%); animation-delay: -5s; }
        .blob-3 { top: 40%; left: 30%; width: 40vw; height: 40vw; background: radial-gradient(circle, #6366f1 0%, transparent 60%); opacity: 0.2; animation-delay: -10s; }

        /* Noise Texture */
        .noise-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            opacity: 0.035;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* --- 3. Glassmorphism System (Part C & G) --- */
        .glass-panel {
            background: rgba(15, 23, 42, 0.65);
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        .glass-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.04) 0%, rgba(255, 255, 255, 0.01) 100%);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.06);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Bouncy spring */
            position: relative;
            overflow: hidden;
        }

        /* Spotlight Effect CSS Logic (Driven by JS mouse tracking) */
        .glass-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(800px circle at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(255, 255, 255, 0.06), transparent 40%);
            z-index: 1;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
        }
        .glass-card:hover::before { opacity: 1; }

        .glass-card:hover {
            transform: translateY(-5px) scale(1.01);
            border-color: rgba(99, 102, 241, 0.4);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.4), 0 0 20px rgba(99, 102, 241, 0.1);
        }

        /* --- 4. Premium Components --- */
        
        /* Buttons with "Shine Sweep" */
        .btn-primary {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .btn-primary::after {
            content: '';
            position: absolute;
            top: 0; left: -100%; width: 50%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transform: skewX(-20deg);
            transition: 0s;
        }
        .btn-primary:hover::after {
            left: 150%;
            transition: 0.7s;
        }
        .btn-primary:active { transform: scale(0.97); }

        /* Progress Bar Striped Animation */
        .progress-striped {
            background-image: linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.1) 75%, transparent 75%, transparent);
            background-size: 1rem 1rem;
            animation: progress-move 1s linear infinite;
        }
        @keyframes progress-move { from { background-position: 1rem 0; } to { background-position: 0 0; } }

        /* Sidebar Interactions */
        .sidebar-link { position: relative; overflow: hidden; }
        .sidebar-link::before {
            content: ''; position: absolute; left: 0; top: 0; height: 100%; width: 3px;
            background: #6366f1; transform: scaleY(0); transition: transform 0.3s;
        }
        .sidebar-link:hover::before { transform: scaleY(1); }
        .sidebar-link:hover { background: linear-gradient(90deg, rgba(99,102,241,0.1), transparent); }

        /* View Transitions */
        .view-section { animation: fadeInScale 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.98) translateY(10px); filter: blur(4px); }
            100% { opacity: 1; transform: scale(1) translateY(0); filter: blur(0); }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="antialiased selection:bg-brand-500 selection:text-white" onmousemove="handleMouseMove(event)">

    <!-- Part A: Background Animation Added -->
    <div class="ambient-layer">
        <div class="blob-bg blob-1"></div>
        <div class="blob-bg blob-2"></div>
        <div class="blob-bg blob-3"></div>
    </div>
    <div class="noise-overlay"></div>

    <!-- ================= TOAST NOTIFICATION ================= -->
    <div id="toast-container" class="fixed top-6 right-6 z-50 flex flex-col gap-3 pointer-events-none"></div>

    <!-- ================= NAVIGATION (Dynamic) ================= -->
    <nav class="fixed top-0 w-full z-40 glass-panel border-b border-glass-border transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <!-- Logo with Glow -->
                <div class="flex items-center gap-3 cursor-pointer group" onclick="app.router.navigate('landing')">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-brand-500 to-brand-dark flex items-center justify-center shadow-lg shadow-brand-500/40 group-hover:scale-105 transition-transform duration-300">
                        <i data-lucide="graduation-cap" class="text-white w-6 h-6"></i>
                    </div>
                    <span class="font-bold text-2xl tracking-tight text-white group-hover:text-brand-200 transition-colors">EduFlow<span class="text-brand-500">.ai</span></span>
                </div>

                <!-- Desktop Menu (Public) -->
                <div id="nav-public" class="hidden md:flex items-center space-x-8">
                    <a href="#features" class="text-slate-400 hover:text-white transition-colors text-sm font-medium hover:drop-shadow-glow">Features</a>
                    <a href="#how-it-works" class="text-slate-400 hover:text-white transition-colors text-sm font-medium hover:drop-shadow-glow">How it works</a>
                    <button onclick="app.router.navigate('auth')" class="text-slate-300 hover:text-white font-medium text-sm px-5 py-2.5 hover:bg-white/5 rounded-xl transition-all">Log In</button>
                    <button onclick="app.router.navigate('auth', {mode: 'signup'})" class="btn-primary bg-brand-600 hover:bg-brand-500 text-white px-6 py-2.5 rounded-xl text-sm font-semibold shadow-xl shadow-brand-500/20 border border-brand-500/50">
                        Get Started
                    </button>
                </div>

                <!-- Auth User Menu (Hidden by default) -->
                <div id="nav-auth" class="hidden items-center gap-6">
                    <div class="text-right hidden sm:block">
                        <p id="nav-user-name" class="text-sm font-semibold text-white tracking-wide">Loading...</p>
                        <p id="nav-user-role" class="text-[10px] text-brand-400 uppercase tracking-widest font-bold">Student</p>
                    </div>
                    <button onclick="app.auth.logout()" class="p-2.5 rounded-xl bg-white/5 hover:bg-red-500/20 hover:text-red-400 text-slate-400 transition-all border border-transparent hover:border-red-500/30 group">
                        <i data-lucide="log-out" class="w-5 h-5 group-hover:-translate-x-1 transition-transform"></i>
                    </button>
                </div>
                
                <!-- Mobile menu button -->
                <div class="md:hidden flex items-center">
                    <button class="text-slate-300 hover:text-white p-2">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ================= MAIN CONTAINER ================= -->
    <main id="app-container" class="pt-20 min-h-screen relative">
        
        <!-- VIEW: LANDING PAGE -->
        <section id="view-landing" class="view-section">
            <!-- Hero (Part B & G applied via CSS/JS) -->
            <div class="relative overflow-visible">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-20 text-center lg:pt-36">
                    
                    <!-- Floating Badge -->
                    <div class="animate-float inline-flex items-center px-4 py-1.5 rounded-full border border-brand-500/30 bg-brand-500/10 text-brand-300 text-xs font-semibold mb-8 backdrop-blur-md shadow-lg shadow-brand-500/20">
                        <span class="flex h-2 w-2 rounded-full bg-brand-400 mr-2 animate-pulse"></span>
                        AI-Powered Onboarding v2.0
                    </div>
                    
                    <!-- Animated Headline -->
                    <h1 class="text-5xl sm:text-7xl font-extrabold text-white tracking-tight mb-8 leading-[1.1]">
                        Admission to Activation <br>
                        <span class="text-transparent bg-clip-text bg-gradient-to-r from-brand-400 via-purple-300 to-brand-400 bg-[length:200%_auto] animate-[shimmer_4s_linear_infinite]">Powered by Intelligence</span>
                    </h1>
                    
                    <p class="mt-4 text-lg text-slate-400 max-w-2xl mx-auto mb-12 leading-relaxed">
                        Automate student verification, document parsing, and campus integration with our engineering-first onboarding platform.
                    </p>
                    
                    <div class="flex flex-col sm:flex-row justify-center gap-5">
                        <button onclick="app.router.navigate('auth', {mode: 'signup'})" class="btn-primary bg-brand-600 hover:bg-brand-500 text-white px-8 py-4 rounded-xl font-semibold text-base transition-all shadow-2xl shadow-brand-500/40 flex items-center justify-center gap-2 group border-t border-white/10">
                            Start Onboarding <i data-lucide="arrow-right" class="w-4 h-4 group-hover:translate-x-1 transition-transform"></i>
                        </button>
                        <button onclick="app.router.navigate('auth', {role: 'admin'})" class="glass-card text-white px-8 py-4 rounded-xl font-semibold text-base hover:bg-white/10 transition-all flex items-center justify-center hover:border-brand-500/30">
                            Admin Login
                        </button>
                    </div>

                    <!-- Mock Dashboard Preview with Depth Layer (Part C) -->
                    <div class="mt-24 relative group perspective-container">
                        <!-- Glow behind -->
                        <div class="absolute -inset-4 bg-gradient-to-r from-brand-600 to-purple-600 rounded-3xl blur-2xl opacity-20 group-hover:opacity-30 transition duration-1000"></div>
                        
                        <div class="glass-panel rounded-2xl p-2 max-w-5xl mx-auto transform transition-transform duration-700 shadow-2xl border border-white/10 relative z-10 tilt-card">
                            <div class="bg-[#0B0F1A] rounded-xl overflow-hidden border border-white/5 aspect-video flex items-center justify-center relative">
                                <!-- UI Mock -->
                                <div class="absolute inset-0 bg-[#0B0F1A] flex">
                                    <div class="w-20 border-r border-white/5 h-full flex flex-col items-center pt-6 gap-6 bg-white/[0.02]">
                                        <div class="w-10 h-10 bg-slate-800 rounded-lg animate-pulse"></div>
                                        <div class="w-10 h-10 bg-slate-800/50 rounded-lg"></div>
                                        <div class="w-10 h-10 bg-slate-800/50 rounded-lg"></div>
                                    </div>
                                    <div class="flex-1 p-8">
                                        <div class="flex justify-between mb-10">
                                            <div class="h-10 w-48 bg-slate-800 rounded-lg animate-pulse"></div>
                                            <div class="h-10 w-10 bg-brand-600 rounded-full shadow-lg shadow-brand-500/30"></div>
                                        </div>
                                        <div class="grid grid-cols-3 gap-6">
                                            <div class="h-40 bg-slate-800/40 rounded-xl border border-white/5"></div>
                                            <div class="h-40 bg-slate-800/40 rounded-xl border border-white/5"></div>
                                            <div class="h-40 bg-slate-800/40 rounded-xl border border-white/5"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-t from-[#0B0F1A] via-transparent to-transparent"></div>
                                <span class="relative z-10 text-slate-500 font-mono text-xs uppercase tracking-widest bg-black/60 backdrop-blur px-3 py-1 rounded border border-white/10">Interactive Preview</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Features Grid -->
            <div id="features" class="max-w-7xl mx-auto px-4 py-24">
                <div class="grid md:grid-cols-3 gap-8">
                    <!-- Feature 1 -->
                    <div class="glass-card p-8 rounded-3xl group hover:bg-white/[0.02]">
                        <div class="w-16 h-16 rounded-2xl bg-blue-500/10 border border-blue-500/20 flex items-center justify-center mb-6 text-blue-400 group-hover:scale-110 group-hover:rotate-3 transition-transform duration-500 shadow-[0_0_20px_rgba(59,130,246,0.15)]">
                            <i data-lucide="file-check" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-3 group-hover:text-blue-300 transition-colors">Smart Doc Verification</h3>
                        <p class="text-slate-400 text-sm leading-relaxed">AI pre-scans documents for errors before they reach admin, reducing rejection loops significantly.</p>
                    </div>
                    <!-- Feature 2 -->
                    <div class="glass-card p-8 rounded-3xl group hover:bg-white/[0.02]">
                        <div class="w-16 h-16 rounded-2xl bg-brand-500/10 border border-brand-500/20 flex items-center justify-center mb-6 text-brand-400 group-hover:scale-110 group-hover:-rotate-3 transition-transform duration-500 shadow-[0_0_20px_rgba(99,102,241,0.15)]">
                            <i data-lucide="activity" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-3 group-hover:text-brand-300 transition-colors">Risk Analytics</h3>
                        <p class="text-slate-400 text-sm leading-relaxed">Real-time identification of students falling behind on deadlines or payments with predictive scoring.</p>
                    </div>
                    <!-- Feature 3 -->
                    <div class="glass-card p-8 rounded-3xl group hover:bg-white/[0.02]">
                        <div class="w-16 h-16 rounded-2xl bg-emerald-500/10 border border-emerald-500/20 flex items-center justify-center mb-6 text-emerald-400 group-hover:scale-110 group-hover:rotate-3 transition-transform duration-500 shadow-[0_0_20px_rgba(16,185,129,0.15)]">
                            <i data-lucide="bot" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-3 group-hover:text-emerald-300 transition-colors">24/7 AI Guidance</h3>
                        <p class="text-slate-400 text-sm leading-relaxed">Context-aware chatbot helps students navigate LMS setup, hostels, and curriculum instantly.</p>
                    </div>
                </div>
            </div>

            <!-- Pipeline -->
            <div id="how-it-works" class="border-t border-white/5 bg-black/30 backdrop-blur-xl">
                <div class="max-w-7xl mx-auto px-4 py-24">
                    <h2 class="text-3xl font-bold text-center mb-16 text-white tracking-tight">The Smart Pipeline</h2>
                    <div class="flex flex-col md:flex-row justify-between items-center gap-6 relative">
                        <!-- Line connecting steps -->
                        <div class="hidden md:block absolute top-1/2 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-brand-500/30 to-transparent -z-10 transform -translate-y-1/2"></div>
                        
                        <div class="glass-card p-6 rounded-2xl z-10 w-full md:w-auto text-center border border-white/10 min-w-[150px] hover:border-brand-500/50 hover:shadow-lg transition-all duration-300">
                            <span class="block text-brand-400 font-extrabold text-2xl mb-1">01</span> 
                            <span class="text-sm font-semibold text-slate-300 uppercase tracking-wide">Admission</span>
                        </div>
                        <div class="glass-card p-6 rounded-2xl z-10 w-full md:w-auto text-center border border-white/10 min-w-[150px] hover:border-brand-500/50 hover:shadow-lg transition-all duration-300">
                            <span class="block text-brand-400 font-extrabold text-2xl mb-1">02</span> 
                            <span class="text-sm font-semibold text-slate-300 uppercase tracking-wide">AI Checklist</span>
                        </div>
                        <div class="glass-card p-6 rounded-2xl z-10 w-full md:w-auto text-center border border-white/10 min-w-[150px] hover:border-brand-500/50 hover:shadow-lg transition-all duration-300">
                            <span class="block text-brand-400 font-extrabold text-2xl mb-1">03</span> 
                            <span class="text-sm font-semibold text-slate-300 uppercase tracking-wide">Doc Upload</span>
                        </div>
                        <div class="glass-card p-6 rounded-2xl z-10 w-full md:w-auto text-center border border-white/10 min-w-[150px] hover:border-brand-500/50 hover:shadow-lg transition-all duration-300">
                            <span class="block text-brand-400 font-extrabold text-2xl mb-1">04</span> 
                            <span class="text-sm font-semibold text-slate-300 uppercase tracking-wide">Verification</span>
                        </div>
                        <div class="bg-brand-600/20 border border-brand-500/50 p-6 rounded-2xl z-10 w-full md:w-auto text-center shadow-[0_0_30px_rgba(99,102,241,0.4)] backdrop-blur-xl min-w-[150px] animate-pulse">
                            <span class="block text-white font-extrabold text-2xl mb-1">05</span> 
                            <span class="text-sm font-bold text-brand-100 uppercase tracking-wide">Activation</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <footer class="border-t border-white/10 py-12 text-center text-slate-500 text-sm bg-black/40">
                <p>&copy; 2026 EduFlow Education. <span class="text-slate-700">All rights reserved.</span></p>
            </footer>
        </section>

        <!-- VIEW: AUTHENTICATION -->
        <section id="view-auth" class="hidden view-section min-h-[calc(100vh-64px)] flex items-center justify-center p-4 relative">
            
            <!-- Auth Card with Back Button -->
            <div class="glass-panel w-full max-w-md p-10 rounded-3xl shadow-2xl relative border border-white/10 animate-fade-in-up backdrop-blur-2xl">
                
                <!-- Close Button -->
                <button onclick="app.router.navigate('landing')" class="absolute top-5 right-5 p-2 rounded-full text-slate-400 hover:text-white hover:bg-white/10 transition-all z-20" title="Back to Home">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>

                <div class="text-center mb-10">
                    <div class="w-14 h-14 bg-brand-500/10 rounded-2xl flex items-center justify-center mx-auto mb-5 border border-brand-500/20 shadow-[0_0_20px_rgba(99,102,241,0.15)]">
                        <i data-lucide="user-circle" class="w-7 h-7 text-brand-400"></i>
                    </div>
                    <h2 id="auth-title" class="text-3xl font-bold text-white mb-2">Student Portal</h2>
                    <p id="auth-subtitle" class="text-slate-400 text-sm">Enter your credentials to access the dashboard</p>
                </div>

                <form id="auth-form" class="space-y-6">
                    <div id="auth-fields-container" class="space-y-6"></div>
                    <button type="submit" class="btn-primary w-full bg-brand-600 hover:bg-brand-500 text-white py-4 rounded-xl font-semibold transition-all shadow-lg shadow-brand-900/50 flex justify-center items-center gap-2 group">
                        <span id="auth-btn-text">Log In</span>
                        <i data-lucide="arrow-right" class="w-4 h-4 group-hover:translate-x-1 transition-transform"></i>
                    </button>
                </form>

                <div class="mt-8 text-center text-sm">
                    <button id="auth-toggle-btn" class="text-brand-400 hover:text-brand-300 font-medium hover:underline underline-offset-4 transition-colors">
                        Don't have an account? Sign up
                    </button>
                    <div class="mt-6 pt-6 border-t border-white/5">
                        <button id="admin-login-link" class="text-slate-500 hover:text-white text-xs uppercase tracking-wider font-bold transition-colors">Access Admin Portal</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW: STUDENT DASHBOARD LAYOUT -->
        <div id="student-layout" class="hidden h-[calc(100vh-80px)] flex">
            <!-- Sidebar -->
            <aside class="w-72 glass-panel border-r border-glass-border hidden lg:flex flex-col bg-black/20 backdrop-blur-xl">
                <div class="p-6">
                    <div class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-6 px-4">Main Menu</div>
                    <nav class="space-y-1">
                        <button onclick="app.router.navigate('student-dash')" class="sidebar-link w-full flex items-center gap-3 px-4 py-3.5 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all text-sm font-medium group">
                            <i data-lucide="layout-dashboard" class="w-5 h-5 text-slate-500 group-hover:text-brand-400 transition-colors"></i> Dashboard
                        </button>
                        <button onclick="app.router.navigate('student-checklist')" class="sidebar-link w-full flex items-center gap-3 px-4 py-3.5 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all text-sm font-medium group">
                            <i data-lucide="check-square" class="w-5 h-5 text-slate-500 group-hover:text-brand-400 transition-colors"></i> Checklist
                        </button>
                        <button onclick="app.router.navigate('student-docs')" class="sidebar-link w-full flex items-center gap-3 px-4 py-3.5 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all text-sm font-medium group">
                            <i data-lucide="file-text" class="w-5 h-5 text-slate-500 group-hover:text-brand-400 transition-colors"></i> Documents
                        </button>
                        <button class="sidebar-link w-full flex items-center gap-3 px-4 py-3.5 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all text-sm font-medium group">
                            <i data-lucide="book-open" class="w-5 h-5 text-slate-500 group-hover:text-brand-400 transition-colors"></i> LMS Guidance
                        </button>
                    </nav>
                </div>
                
                <div class="mt-auto p-6">
                    <div id="deadline-banner" class="bg-gradient-to-br from-red-900/40 to-red-900/10 border border-red-500/30 rounded-2xl p-5 backdrop-blur-md shadow-lg shadow-red-900/20">
                        <div class="flex items-center gap-2 text-red-400 mb-2">
                            <i data-lucide="alert-circle" class="w-4 h-4 animate-pulse"></i>
                            <span class="text-xs font-bold uppercase tracking-wide">Critical Update</span>
                        </div>
                        <p class="text-sm text-slate-300 leading-snug">Fee payment deadline in <span class="text-white font-bold border-b border-red-500/50">2 days</span>.</p>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 overflow-y-auto relative bg-transparent scroll-smooth p-6">
                
                <!-- CONTENT: DASHBOARD HOME (Part D) -->
                <div id="view-student-dash" class="view-content max-w-6xl mx-auto space-y-8 animate-fade-in-up">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                        <div>
                            <h1 class="text-3xl font-bold text-white tracking-tight">Welcome back, <span id="dash-student-name" class="text-transparent bg-clip-text bg-gradient-to-r from-brand-400 to-purple-400">Student</span></h1>
                            <p class="text-slate-400 text-sm mt-1">Course: <span id="dash-course-name" class="font-mono text-brand-200">Loading...</span></p>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="px-4 py-1.5 bg-emerald-500/10 text-emerald-400 rounded-full text-xs font-semibold border border-emerald-500/20 shadow-lg shadow-emerald-500/10 flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div> Sem 1 Active</span>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Health Score -->
                        <div class="glass-card p-8 rounded-3xl flex items-center justify-between relative overflow-hidden group">
                            <div class="absolute right-0 top-0 w-32 h-32 bg-emerald-500/10 rounded-full blur-3xl group-hover:bg-emerald-500/20 transition-colors duration-500"></div>
                            <div>
                                <p class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-2">Onboarding Health</p>
                                <h3 id="health-score-val" class="text-5xl font-extrabold text-emerald-400 mt-1 tracking-tight">--</h3>
                                <p class="text-xs text-slate-500 mt-2 font-medium">Based on task velocity</p>
                            </div>
                            <div class="w-16 h-16 rounded-2xl bg-emerald-500/10 border border-emerald-500/20 flex items-center justify-center text-emerald-400 shadow-[0_0_20px_rgba(16,185,129,0.15)]">
                                <i data-lucide="activity" class="w-8 h-8"></i>
                            </div>
                        </div>

                        <!-- Progress -->
                        <div class="glass-card p-8 rounded-3xl col-span-1 md:col-span-2 relative overflow-hidden group">
                             <div class="absolute right-0 bottom-0 w-48 h-48 bg-brand-500/10 rounded-full blur-3xl group-hover:bg-brand-500/20 transition-colors duration-500"></div>
                            <div class="flex justify-between items-end mb-6 relative z-10">
                                <div>
                                    <p class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-2">Overall Progress</p>
                                    <h3 id="progress-val" class="text-5xl font-extrabold text-white mt-1 tracking-tight">0%</h3>
                                </div>
                                <span class="text-xs font-semibold text-brand-300 bg-brand-500/10 px-3 py-1.5 rounded-lg border border-brand-500/20 shadow-lg">On Track</span>
                            </div>
                            <div class="w-full bg-slate-800/50 rounded-full h-4 overflow-hidden border border-white/5 relative z-10">
                                <div id="progress-bar" class="progress-striped h-4 rounded-full transition-all duration-1000 bg-gradient-to-r from-brand-600 via-brand-500 to-purple-500 shadow-[0_0_15px_rgba(99,102,241,0.6)]" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2"><i data-lucide="list-todo" class="w-5 h-5 text-brand-400"></i> Priority Tasks</h3>
                        <div id="next-tasks-container" class="grid md:grid-cols-3 gap-6">
                            <div class="glass-card p-6 rounded-2xl animate-pulse h-32 bg-white/5"></div>
                            <div class="glass-card p-6 rounded-2xl animate-pulse h-32 bg-white/5"></div>
                            <div class="glass-card p-6 rounded-2xl animate-pulse h-32 bg-white/5"></div>
                        </div>
                    </div>
                </div>

                <!-- CONTENT: CHECKLIST -->
                <div id="view-student-checklist" class="hidden view-content max-w-5xl mx-auto animate-fade-in-up">
                    <h2 class="text-3xl font-bold text-white mb-8">Onboarding Checklist</h2>
                    <div class="flex overflow-x-auto gap-3 mb-8 pb-2 hide-scrollbar">
                        <button class="checklist-tab active px-6 py-3 rounded-2xl bg-brand-600 text-white text-sm font-semibold whitespace-nowrap shadow-lg shadow-brand-500/20 transition-all hover:scale-105 border border-transparent">All Tasks</button>
                        <button class="checklist-tab px-6 py-3 rounded-2xl bg-white/5 hover:bg-white/10 border border-white/10 text-slate-300 hover:text-white text-sm font-medium whitespace-nowrap transition-all">Documents</button>
                        <button class="checklist-tab px-6 py-3 rounded-2xl bg-white/5 hover:bg-white/10 border border-white/10 text-slate-300 hover:text-white text-sm font-medium whitespace-nowrap transition-all">Fees</button>
                        <button class="checklist-tab px-6 py-3 rounded-2xl bg-white/5 hover:bg-white/10 border border-white/10 text-slate-300 hover:text-white text-sm font-medium whitespace-nowrap transition-all">LMS</button>
                    </div>
                    <div id="checklist-container" class="space-y-4"></div>
                </div>

                <!-- CONTENT: DOCUMENTS -->
                <div id="view-student-docs" class="hidden view-content max-w-5xl mx-auto animate-fade-in-up">
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-3xl font-bold text-white">Document Vault</h2>
                        <button onclick="document.getElementById('upload-modal').classList.remove('hidden')" class="btn-primary bg-brand-600 hover:bg-brand-500 text-white px-6 py-3 rounded-xl text-sm font-semibold flex items-center gap-2 shadow-xl shadow-brand-500/20 border-t border-white/20">
                            <i data-lucide="upload-cloud" class="w-4 h-4"></i> Upload New
                        </button>
                    </div>
                    <div class="glass-panel rounded-3xl overflow-hidden border border-white/10 shadow-2xl">
                        <table class="w-full text-left text-sm text-slate-400">
                            <thead class="bg-white/5 text-xs uppercase font-semibold text-slate-300 tracking-wider">
                                <tr>
                                    <th class="px-8 py-5">Document Name</th><th class="px-8 py-5">Type</th><th class="px-8 py-5">Date</th><th class="px-8 py-5">Status</th>
                                </tr>
                            </thead>
                            <tbody id="docs-table-body" class="divide-y divide-white/5"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Floating Chat (Part D) -->
                <button onclick="toggleChat()" class="pulse-btn fixed bottom-10 right-10 w-16 h-16 bg-brand-600 hover:bg-brand-500 text-white rounded-full shadow-2xl shadow-brand-600/50 flex items-center justify-center transition-all hover:scale-110 z-50 border border-white/20">
                    <i data-lucide="message-circle" class="w-7 h-7"></i>
                </button>

                <!-- CHAT WINDOW (Part F) -->
                <div id="chat-window" class="hidden fixed bottom-28 right-10 w-96 h-[500px] glass-panel rounded-2xl flex flex-col border border-glass-border z-50 shadow-2xl animate-fade-in-up overflow-hidden backdrop-blur-3xl">
                    <div class="p-5 border-b border-glass-border font-bold bg-slate-900/60 text-white flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-brand-500/20 flex items-center justify-center text-brand-400 ring-2 ring-brand-500/10">
                            <i data-lucide="bot" class="w-5 h-5"></i>
                        </div>
                        EduFlow AI
                    </div>
                    <div id="chat-messages" class="flex-1 p-5 overflow-y-auto space-y-4 text-sm bg-black/20">
                        <div class="bg-slate-800/80 border border-white/5 p-4 rounded-2xl rounded-tl-none max-w-[85%] text-slate-200 shadow-sm">
                            Hi! I'm here to help. Ask me about <strong>fees</strong>, <strong>documents</strong>, or <strong>hostels</strong>.
                        </div>
                    </div>
                    <div class="p-4 border-t border-glass-border flex gap-3 bg-slate-900/80 backdrop-blur-md">
                        <input id="chat-input" type="text" placeholder="Type your query..." class="flex-1 bg-slate-800/50 border border-white/10 rounded-xl px-4 py-3 text-sm text-white focus:outline-none focus:border-brand-500 focus:bg-slate-800 transition-all placeholder:text-slate-500">
                        <button onclick="sendMessage()" class="bg-brand-600 hover:bg-brand-500 p-3 rounded-xl text-white transition-colors shadow-lg shadow-brand-500/20 hover:scale-105 active:scale-95">
                            <i data-lucide="send" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </main>
        </div>

        <!-- VIEW: ADMIN DASHBOARD (Part E) -->
        <div id="view-admin-dashboard" class="hidden view-section p-8 max-w-7xl mx-auto animate-fade-in-up">
            <h1 class="text-3xl font-bold text-white mb-10 tracking-tight">Admin Overview</h1>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
                <div class="glass-card p-6 rounded-2xl group hover:border-brand-500/30">
                    <p class="text-slate-400 text-xs uppercase font-bold tracking-wider mb-2">Total Students</p>
                    <h3 class="text-4xl font-extrabold text-white mt-1 group-hover:scale-110 transition-transform origin-left duration-300" id="admin-total-students">...</h3>
                </div>
                <div class="glass-card p-6 rounded-2xl group hover:border-yellow-500/30">
                    <p class="text-slate-400 text-xs uppercase font-bold tracking-wider mb-2">Pending Docs</p>
                    <h3 class="text-4xl font-extrabold text-yellow-400 mt-1 group-hover:scale-110 transition-transform origin-left duration-300" id="admin-pending-docs">...</h3>
                </div>
                <div class="glass-card p-6 rounded-2xl border border-red-500/20 bg-red-900/5 group relative overflow-hidden hover:border-red-500/40">
                    <div class="absolute right-0 top-0 w-24 h-24 bg-red-500/10 rounded-full blur-2xl animate-pulse"></div>
                    <p class="text-red-400 text-xs uppercase font-bold tracking-wider mb-2">At Risk</p>
                    <h3 class="text-4xl font-extrabold text-white mt-1 group-hover:scale-110 transition-transform origin-left duration-300" id="admin-risk-count">...</h3>
                </div>
                <!-- Bottleneck Chart -->
                <div class="glass-card p-6 rounded-2xl flex flex-col justify-end">
                    <p class="text-slate-400 text-xs uppercase font-bold mb-4 tracking-wider">Process Bottlenecks</p>
                    <div class="flex items-end gap-3 h-16">
                        <div class="w-1/3 bg-blue-500/20 h-[40%] rounded-t-lg border-t border-blue-500/30 transition-all hover:bg-blue-500/30"></div>
                        <div class="w-1/3 bg-gradient-to-t from-blue-600/80 to-blue-500 h-[80%] rounded-t-lg relative group/bar cursor-help shadow-[0_0_15px_rgba(59,130,246,0.3)] transition-all hover:h-[85%]">
                            <div class="absolute -top-8 left-1/2 -translate-x-1/2 text-[10px] bg-slate-900 text-white px-2 py-1 rounded border border-white/10 opacity-0 group-hover/bar:opacity-100 transition-opacity whitespace-nowrap shadow-xl">Fees (80%)</div>
                        </div>
                        <div class="w-1/3 bg-blue-500/20 h-[30%] rounded-t-lg border-t border-blue-500/30 transition-all hover:bg-blue-500/30"></div>
                    </div>
                </div>
            </div>

            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Verification Queue -->
                <div class="glass-panel p-8 rounded-3xl border border-white/10 shadow-2xl">
                    <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2"><i data-lucide="file-check-2" class="w-5 h-5 text-brand-400"></i> Verification Queue</h3>
                    <div id="admin-verification-list" class="space-y-4"></div>
                </div>

                <!-- Student List -->
                <div class="glass-panel p-8 rounded-3xl border border-white/10 shadow-2xl">
                    <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2"><i data-lucide="users" class="w-5 h-5 text-brand-400"></i> Student Progress</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm text-slate-400">
                            <thead class="bg-white/5 text-xs uppercase font-semibold text-slate-300">
                                <tr>
                                    <th class="px-6 py-4 rounded-l-lg">Name</th><th class="px-6 py-4">Course</th><th class="px-6 py-4">Risk</th><th class="px-6 py-4 rounded-r-lg">Progress</th>
                                </tr>
                            </thead>
                            <tbody id="admin-student-table" class="divide-y divide-white/5"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Upload Modal (Part F) -->
    <div id="upload-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-md transition-opacity duration-300">
        <div class="glass-panel w-full max-w-md p-8 rounded-3xl border border-white/10 shadow-2xl transform transition-all scale-100 animate-fade-in-up">
            <h3 class="text-2xl font-bold text-white mb-6">Upload Document</h3>
            <form onsubmit="app.handlers.handleDocUpload(event)" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-slate-400 mb-2">Document Type</label>
                    <select id="doc-type-select" class="w-full bg-slate-900/80 border border-white/10 text-white rounded-xl p-3 focus:border-brand-500 focus:ring-1 focus:ring-brand-500 outline-none transition-all">
                        <option value="ID Proof">Identity Proof</option>
                        <option value="Mark Sheet">12th Grade Mark Sheet</option>
                        <option value="Medical">Medical Certificate</option>
                    </select>
                </div>
                <div class="border-2 border-dashed border-white/10 rounded-xl p-10 text-center hover:border-brand-500/50 hover:bg-white/5 transition-all cursor-pointer relative group">
                    <input type="file" required class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                    <div class="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300 shadow-inner">
                        <i data-lucide="cloud-upload" class="w-8 h-8 text-brand-400"></i>
                    </div>
                    <p class="text-sm text-slate-400 font-medium">Click to select or drag file here</p>
                    <p class="text-xs text-slate-600 mt-1">PDF, JPG, PNG up to 5MB</p>
                </div>
                <div class="flex gap-4 pt-2">
                    <button type="button" onclick="document.getElementById('upload-modal').classList.add('hidden')" class="flex-1 px-6 py-3 rounded-xl border border-white/10 text-slate-300 hover:bg-white/5 hover:text-white transition-colors font-medium">Cancel</button>
                    <button type="submit" class="flex-1 px-6 py-3 rounded-xl bg-brand-600 hover:bg-brand-500 text-white font-medium shadow-lg shadow-brand-500/20 transition-all hover:-translate-y-0.5">Upload</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ================= JAVASCRIPT LOGIC ================= -->
    <script>
        // --- JS HELPER: Count Up Animation (Part D & E) ---
        function animateValue(obj, start, end, duration) {
            if(!obj) return;
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // --- JS HELPER: Spotlight Mouse Tracking (Part B) ---
        function handleMouseMove(e) {
            const cards = document.querySelectorAll('.glass-card, .btn-primary');
            cards.forEach(card => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                card.style.setProperty('--mouse-x', `${x}px`);
                card.style.setProperty('--mouse-y', `${y}px`);
            });
        }

        // API Handler (Flask Backend)
        class RealAPI {
            constructor() {
                this.base = "http://localhost:5000/api";
                this.user = JSON.parse(localStorage.getItem("eduflow_user")) || null;
            }

            setUser(u) {
                this.user = u;
                localStorage.setItem("eduflow_user", JSON.stringify(u));
            }

            clearUser() {
                this.user = null;
                localStorage.removeItem("eduflow_user");
            }

            async request(path, options = {}) {
                const headers = options.headers || {};
                headers["Content-Type"] = "application/json";
                if (this.user) {
                    headers["x-user-id"] = this.user.id;
                    headers["x-role"] = this.user.role;
                }

                try {
                    const res = await fetch(this.base + path, { ...options, headers });
                    const data = await res.json().catch(() => ({}));
                    if (!res.ok) throw new Error(data.message || "API Error");
                    return data;
                } catch (err) {
                    console.error("API Request Failed:", err);
                    throw err;
                }
            }

            // Methods
            login(email, password) { return this.request("/auth/login", { method: "POST", body: JSON.stringify({ email, password }) }); }
            signup(data) { return this.request("/auth/signup", { method: "POST", body: JSON.stringify(data) }); }
            
            getStudentDashboard() { return this.request("/student/dashboard"); }
            completeTask(id) { return this.request(`/student/tasks/${id}/complete`, { method: "POST" }); }
            getDocuments() { return this.request("/student/docs"); }
            uploadDocument(data) { return this.request("/student/docs", { method: "POST", body: JSON.stringify(data) }); }
            
            getAdminStats() { return this.request("/admin/stats"); }
            verifyDoc(id, status) { return this.request(`/admin/doc/${id}`, { method: "PATCH", body: JSON.stringify({ status }) }); }
            
            chat(msg) { return this.request("/chat", { method: "POST", body: JSON.stringify({ message: msg }) }); }
        }

        // App Controller
        const app = {
            api: new RealAPI(),
            state: { view: 'landing' },
            
            ui: {
                showToast: (msg, type = 'info') => {
                    const container = document.getElementById('toast-container');
                    const toast = document.createElement('div');
                    const colors = type === 'error' ? 'bg-red-500/90 border-red-500/50' : 'bg-emerald-500/90 border-emerald-500/50';
                    toast.className = `${colors} text-white px-6 py-4 rounded-xl shadow-2xl backdrop-blur-md border text-sm font-semibold animate-fade-in flex items-center gap-3 min-w-[300px] transform transition-all hover:scale-105`;
                    toast.innerHTML = type === 'error' ? `<i data-lucide="alert-circle" class="w-5 h-5"></i> ${msg}` : `<i data-lucide="check-circle" class="w-5 h-5"></i> ${msg}`;
                    container.appendChild(toast);
                    lucide.createIcons();
                    setTimeout(() => toast.remove(), 4000);
                },
                toggleLoading: (btnId, isLoading) => {
                    const btn = document.getElementById(btnId);
                    if(!btn) return;
                    if(isLoading) {
                        btn.dataset.originalText = btn.innerHTML;
                        btn.innerHTML = `<span class="animate-spin mr-2 inline-block"></span> Processing...`;
                        btn.disabled = true;
                        btn.classList.add('opacity-75', 'cursor-not-allowed');
                    } else {
                        btn.innerHTML = btn.dataset.originalText;
                        btn.disabled = false;
                        btn.classList.remove('opacity-75', 'cursor-not-allowed');
                    }
                }
            },

            router: {
                navigate: async (viewId, params = {}) => {
                    app.state.view = viewId;
                    
                    // Hide all views
                    document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
                    document.getElementById('student-layout').classList.add('hidden');
                    
                    // Route Logic
                    if (viewId === 'landing') {
                        document.getElementById('view-landing').classList.remove('hidden');
                        app.auth.updateNav();
                    } 
                    else if (viewId === 'auth') {
                        document.getElementById('view-auth').classList.remove('hidden');
                        app.renderers.renderAuthForm(params.mode || 'login', params.role || 'student');
                    }
                    else if (viewId.startsWith('student-')) {
                        if (!app.api.user || app.api.user.role !== 'student') return app.router.navigate('auth');
                        document.getElementById('student-layout').classList.remove('hidden');
                        document.querySelectorAll('.view-content').forEach(el => el.classList.add('hidden'));
                        document.getElementById(`view-${viewId}`).classList.remove('hidden');
                        
                        if(viewId === 'student-dash') app.handlers.loadStudentDashboard();
                        if(viewId === 'student-checklist') app.handlers.loadStudentDashboard();
                        if(viewId === 'student-docs') app.handlers.loadDocuments();
                    }
                    else if (viewId === 'admin-dashboard') {
                        if (!app.api.user || app.api.user.role !== 'admin') return app.router.navigate('auth', {role: 'admin'});
                        document.getElementById('view-admin-dashboard').classList.remove('hidden');
                        app.handlers.loadAdminDashboard();
                    }

                    window.scrollTo(0,0);
                    lucide.createIcons();
                }
            },

            auth: {
                updateNav: () => {
                    const pub = document.getElementById('nav-public');
                    const pvt = document.getElementById('nav-auth');
                    if (app.api.user) {
                        pub.classList.add('hidden');
                        pvt.classList.remove('hidden');
                        pvt.classList.add('flex');
                        document.getElementById('nav-user-name').textContent = app.api.user.name;
                        document.getElementById('nav-user-role').textContent = app.api.user.role;
                    } else {
                        pub.classList.remove('hidden');
                        pvt.classList.add('hidden');
                        pvt.classList.remove('flex');
                    }
                },
                logout: () => {
                    app.api.clearUser();
                    app.auth.updateNav();
                    app.router.navigate('landing');
                    app.ui.showToast('Logged out successfully');
                }
            },

            renderers: {
                renderAuthForm: (mode, role) => {
                    const isSignup = mode === 'signup';
                    document.getElementById('auth-title').innerText = role === 'admin' ? "Admin Portal" : "Student Portal";
                    document.getElementById('auth-subtitle').innerText = isSignup ? "Create account" : "Welcome back";
                    document.getElementById('auth-btn-text').innerText = isSignup ? "Create Account" : "Log In";
                    
                    const container = document.getElementById('auth-fields-container');
                    
                    // Simple Static Labels (No Overlap)
                    let html = '';
                    if (isSignup) {
                        html += `
                            <div class="mb-5">
                                <label class="block text-sm font-medium text-slate-400 mb-2 ml-1">Full Name</label>
                                <input type="text" id="fname" class="w-full bg-slate-900/50 border border-white/10 rounded-xl px-4 py-3.5 text-white focus:border-brand-500 outline-none transition-all focus:ring-2 focus:ring-brand-500/20" placeholder="Enter full name">
                            </div>
                            <div class="mb-5">
                                <label class="block text-sm font-medium text-slate-400 mb-2 ml-1">Course ID</label>
                                <input type="text" id="course" class="w-full bg-slate-900/50 border border-white/10 rounded-xl px-4 py-3.5 text-white focus:border-brand-500 outline-none transition-all focus:ring-2 focus:ring-brand-500/20" placeholder="e.g. CS-24">
                            </div>`;
                    }
                    html += `
                        <div class="mb-5">
                            <label class="block text-sm font-medium text-slate-400 mb-2 ml-1">Email Address</label>
                            <input type="email" id="email" class="w-full bg-slate-900/50 border border-white/10 rounded-xl px-4 py-3.5 text-white focus:border-brand-500 outline-none transition-all focus:ring-2 focus:ring-brand-500/20" placeholder="name@example.com">
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-slate-400 mb-2 ml-1">Password</label>
                            <input type="password" id="password" class="w-full bg-slate-900/50 border border-white/10 rounded-xl px-4 py-3.5 text-white focus:border-brand-500 outline-none transition-all focus:ring-2 focus:ring-brand-500/20" placeholder="">
                        </div>`;
                    
                    container.innerHTML = html;

                    const toggleBtn = document.getElementById('auth-toggle-btn');
                    toggleBtn.onclick = (e) => {
                        e.preventDefault();
                        app.router.navigate('auth', { mode: isSignup ? 'login' : 'signup', role: role });
                    };
                    toggleBtn.innerText = isSignup ? "Already have an account? Log in" : "Don't have an account? Sign up";
                    
                    const adminLink = document.getElementById('admin-login-link');
                    adminLink.onclick = () => app.router.navigate('auth', {role: role === 'admin' ? 'student' : 'admin'});
                    adminLink.innerText = role === 'admin' ? "Back to Student Login" : "Access Admin Portal";

                    document.getElementById('auth-form').onsubmit = (e) => app.handlers.handleAuthSubmit(e, mode, role);
                }
            },

            handlers: {
                handleAuthSubmit: async (e, mode, role) => {
                    e.preventDefault();
                    const btn = e.target.querySelector('button[type="submit"]');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '<span class="animate-spin inline-block mr-2"></span> Verifying...'; 
                    btn.disabled = true;

                    try {
                        const email = document.getElementById('email').value;
                        const password = document.getElementById('password').value;
                        let res;
                        
                        // Fake delay for premium feel
                        await new Promise(r => setTimeout(r, 800));

                        if (mode === 'signup') {
                            const name = document.getElementById('fname').value;
                            const course = document.getElementById('course').value;
                            res = await app.api.signup({ name, email, password, course, year: '2024' });
                        } else {
                            res = await app.api.login(email, password);
                        }

                        app.api.setUser(res.user);
                        app.auth.updateNav();
                        app.ui.showToast(`Welcome back, ${res.user.name}`);
                        app.router.navigate(role === 'admin' ? 'admin-dashboard' : 'student-dash');
                    } catch (err) {
                        app.ui.showToast(err.message, 'error');
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }
                },

                loadStudentDashboard: async () => {
                    const data = await app.api.getStudentDashboard();
                    document.getElementById('dash-student-name').innerText = data.student.name;
                    document.getElementById('dash-course-name').innerText = data.student.course;
                    
                    // Count up animation
                    animateValue(document.getElementById('health-score-val'), 0, data.healthScore, 1500);
                    animateValue(document.getElementById('progress-val'), 0, data.progress, 1500);
                    
                    document.getElementById('progress-bar').style.width = `${data.progress}%`;

                    const renderTask = (t) => `
                        <div class="glass-card p-6 rounded-2xl flex justify-between items-start group hover:border-brand-500/40 transition-all hover:-translate-y-1">
                            <div>
                                <span class="inline-block px-2.5 py-1 rounded-md text-[10px] font-bold uppercase tracking-wider mb-2 ${t.urgent ? 'bg-red-500/10 text-red-400 border border-red-500/20 animate-pulse' : 'bg-slate-700/50 text-slate-400 border border-slate-600/30'}">${t.category}</span>
                                <h4 class="font-semibold text-white mb-1 group-hover:text-brand-300 transition-colors">${t.title}</h4>
                                <span class="px-2.5 py-1 rounded-md text-xs font-medium inline-block mt-2 ${t.status === 'DONE' ? 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20' : 'bg-yellow-500/10 text-yellow-400 border border-yellow-500/20'}">${t.status}</span>
                            </div>
                            ${t.status !== 'DONE' 
                                ? `<button onclick="app.handlers.completeTask(${t.id}, this)" class="w-12 h-12 rounded-full bg-white/5 hover:bg-brand-600 hover:text-white text-slate-400 flex items-center justify-center transition-all shadow-lg hover:shadow-brand-500/40 border border-white/5"><i data-lucide="circle" class="w-6 h-6"></i></button>` 
                                : `<div class="w-12 h-12 rounded-full bg-emerald-500/10 text-emerald-400 flex items-center justify-center border border-emerald-500/20"><i data-lucide="check-circle" class="w-6 h-6"></i></div>`}
                        </div>
                    `;

                    document.getElementById('next-tasks-container').innerHTML = data.tasks.slice(0, 3).map(renderTask).join('');
                    document.getElementById('checklist-container').innerHTML = data.tasks.map(renderTask).join('');
                    lucide.createIcons();
                },

                completeTask: async (taskId, btnEl) => {
                    btnEl.innerHTML = '<span class="animate-spin"></span>';
                    await app.api.completeTask(taskId);
                    app.ui.showToast('Task marked as done!');
                    app.handlers.loadStudentDashboard();
                },

                loadDocuments: async () => {
                    const docs = await app.api.getDocuments();
                    const tbody = document.getElementById('docs-table-body');
                    tbody.innerHTML = docs.map(doc => `
                        <tr class="group hover:bg-white/[0.02] transition-colors border-b border-white/5 last:border-0">
                            <td class="px-8 py-5 font-medium text-white flex items-center gap-4">
                                <div class="w-10 h-10 rounded-xl bg-indigo-500/10 flex items-center justify-center text-indigo-400 border border-indigo-500/20 group-hover:scale-110 transition-transform"><i data-lucide="file" class="w-5 h-5"></i></div> 
                                ${doc.file_name}
                            </td>
                            <td class="px-8 py-5 text-slate-400">${doc.doc_type}</td>
                            <td class="px-8 py-5 text-xs font-mono text-slate-500">${(doc.uploaded_at || "").slice(0,10)}</td>
                            <td class="px-8 py-5">
                                <span class="px-4 py-1.5 rounded-full text-xs font-bold border ${doc.status === 'APPROVED' ? 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20' : 'bg-yellow-500/10 text-yellow-400 border-yellow-500/20'}">
                                    ${doc.status}
                                </span>
                            </td>
                        </tr>
                    `).join('');
                    lucide.createIcons();
                },

                handleDocUpload: async (e) => {
                    e.preventDefault();
                    app.ui.toggleLoading('upload-modal', true); 
                    const type = document.getElementById('doc-type-select').value;
                    // Fake upload delay
                    await new Promise(r => setTimeout(r, 1000));
                    
                    await app.api.uploadDocument({ doc_type: type, file_name: `${type}_Scan.pdf` });
                    document.getElementById('upload-modal').classList.add('hidden');
                    app.ui.showToast('Document uploaded successfully');
                    app.handlers.loadDocuments();
                },

                loadAdminDashboard: async () => {
                    const data = await app.api.getAdminStats();
                    
                    // Animate numbers
                    animateValue(document.getElementById('admin-total-students'), 0, data.totalStudents, 1500);
                    animateValue(document.getElementById('admin-pending-docs'), 0, data.pendingDocs, 1500);
                    animateValue(document.getElementById('admin-risk-count'), 0, data.atRisk, 1500);

                    document.getElementById('admin-verification-list').innerHTML = data.verificationQueue.map(item => `
                        <div class="flex items-center justify-between bg-slate-900/40 p-4 rounded-xl border border-white/5 hover:border-brand-500/30 transition-colors hover:bg-slate-800/60 group">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-slate-400 font-bold border border-white/10 group-hover:border-brand-500/30 group-hover:text-brand-300 transition-all">
                                    ${item.student.charAt(0)}
                                </div>
                                <div>
                                    <p class="text-white font-medium text-sm group-hover:text-brand-100 transition-colors">${item.student}</p>
                                    <p class="text-xs text-slate-500 flex items-center gap-1"><i data-lucide="file" class="w-3 h-3"></i> ${item.docName}</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="app.handlers.verifyDoc(${item.id}, 'APPROVED')" class="p-2 hover:bg-emerald-500/20 text-slate-400 hover:text-emerald-400 rounded-lg transition-all border border-transparent hover:border-emerald-500/30" title="Approve"><i data-lucide="check" class="w-4 h-4"></i></button>
                                <button onclick="app.handlers.verifyDoc(${item.id}, 'REJECTED')" class="p-2 hover:bg-red-500/20 text-slate-400 hover:text-red-400 rounded-lg transition-all border border-transparent hover:border-red-500/30" title="Reject"><i data-lucide="x" class="w-4 h-4"></i></button>
                            </div>
                        </div>
                    `).join('');

                    document.getElementById('admin-student-table').innerHTML = data.students.map(s => `
                        <tr class="border-b border-white/5 hover:bg-white/[0.02] transition-colors last:border-0">
                            <td class="px-6 py-4 font-medium text-white flex items-center gap-3">
                                <div class="w-2.5 h-2.5 rounded-full ${s.risk==='HIGH'?'bg-red-500 animate-pulse':'bg-emerald-500'}"></div>
                                ${s.name}
                            </td>
                            <td class="px-6 py-4 text-slate-400">${s.course}</td>
                            <td class="px-6 py-4"><span class="text-xs font-bold px-2.5 py-1 rounded border ${s.risk === 'HIGH' ? 'bg-red-500/10 text-red-400 border-red-500/20' : 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20'}">${s.risk}</span></td>
                            <td class="px-6 py-4 w-48">
                                <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden border border-white/5">
                                    <div class="bg-brand-500 h-2 rounded-full shadow-[0_0_10px_rgba(99,102,241,0.5)] relative" style="width: ${s.progress}%">
                                        <div class="absolute inset-0 bg-white/20"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    `).join('');
                    lucide.createIcons();
                },

                verifyDoc: async (id, status) => {
                    await app.api.verifyDoc(id, status);
                    app.ui.showToast(`Document ${status}`);
                    app.handlers.loadAdminDashboard();
                }
            }
        };

        // Chatbot Functions
        function toggleChat() { document.getElementById('chat-window').classList.toggle('hidden'); }
        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const msg = input.value;
            if(!msg) return;
            
            const chatBox = document.getElementById('chat-messages');
            chatBox.innerHTML += `<div class="text-right"><span class="bg-brand-600 p-3 rounded-2xl rounded-tr-sm inline-block mb-3 text-white shadow-lg text-sm">${msg}</span></div>`;
            input.value = '';

            try {
                // Typing indicator
                const typingId = 'typing-' + Date.now();
                chatBox.innerHTML += `<div id="${typingId}" class="text-left"><span class="bg-slate-800 p-3 rounded-2xl rounded-tl-sm inline-block mb-3 text-slate-400 text-xs italic animate-pulse">Thinking...</span></div>`;
                chatBox.scrollTop = chatBox.scrollHeight;

                const data = await app.api.chat(msg);
                
                document.getElementById(typingId).remove();
                chatBox.innerHTML += `<div class="text-left"><span class="bg-slate-800 border border-white/10 p-3 rounded-2xl rounded-tl-sm inline-block mb-3 text-slate-200 text-sm shadow-sm">${data.reply}</span></div>`;
                chatBox.scrollTop = chatBox.scrollHeight;
            } catch(e) { console.error(e); }
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            // Optional: Auto-login check if already logged in
            if(app.api.user) app.auth.updateNav();
        });

    </script>
</body>
</html>